<%= javascript_tag nonce: true do -%>
  var cookieText = "<%= @cookie_text %>"
  var tarteaucitronCustomText = {
  "alertBigPrivacy": cookieText
  };
<% end %>

<%= javascript_include_tag 'https://cdn.jsdelivr.net/npm/tarteaucitronjs@1.9.7/tarteaucitron.min.js', crossorigin: 'anonymous', integrity: "sha256-8+pErQEggpGAY7uWiB65tL13ivQ31A3HKA55CEqYniU=", nonce: true %>

<%= javascript_tag nonce: true do -%>
  tarteaucitron.services.google_ads = {
    "key": "google_ads",
    "type": "ads",
    "name": "Google Ads (remarketing)",
    "uri": "https://policies.google.com/privacy",
    "needConsent": true,
    "cookies": ['__Secure-3PSIDCC', '__Secure-3PSID', '__Secure-3PAPISID', 'NID'],
    "js": function () {
      "use strict";
      tarteaucitron.addScript('https://www.googletagmanager.com/gtag/js?id=' + tarteaucitron.user.gtagAw);
      window.dataLayer = window.dataLayer || [];
      window.gtag = function gtag() { dataLayer.push(arguments); }
      gtag('consent', 'update', {
        'ad_storage': 'granted'
      });
      gtag('js', new Date());
      gtag('config', tarteaucitron.user.gtagAw);
    },
    "fallback": function() {
      "use strict";
      tarteaucitron.addScript('https://www.googletagmanager.com/gtag/js?id=' + tarteaucitron.user.gtagAw);
      window.dataLayer = window.dataLayer || [];
      window.gtag = function gtag() { dataLayer.push(arguments); }
      gtag('consent', 'default', {
        'ad_storage': 'denied'
      });
      gtag('js', new Date());
      gtag('config', tarteaucitron.user.gtagAw);

    }
  };

  tarteaucitron.init({
    "privacyUrl": "",
    "hashtag": "#consentement",
    "cookieName": "tarteaucitron",
    "bodyPosition": "top",
    "adblocker": false,
    "highPrivacy": true,
    "handleBrowserDNTRequest": false,
    "useExternalCss": true,
    "orientation": "bottom",
    "DenyAllCta" : true,
    "AcceptAllCta" : true,
    "closePopup": false,
    "removeCredit": true,
    "moreInfoLink": true,
    "readmoreLink": '/mentions_d_information#utilisation-cookies',
    "mandatory": false,
    "showAlertSmall": false,
    "cookieslist": false,
    "showIcon": false,
    "iconPosition": "BottomLeft",
    "groupServices": false
  });

  tarteaucitron.user.gtagAw = 'AW-415474841';
  (tarteaucitron.job = tarteaucitron.job || []).push('google_ads');
  (tarteaucitron.job = tarteaucitron.job || []).push('youtube');

  tarteaucitron.user.facebookpixelId = '6412308475508271';
  (tarteaucitron.job = tarteaucitron.job || []).push('facebookpixel');
  // tarteaucitron.user.facebookpixelMore = function () { /* add here your optionnal facebook pixel function */ };

  // Ouvre la boite gestion des cookies au clic sur le lien
  document.addEventListener("DOMContentLoaded", function() {
    const cookiesLink = document.getElementById("open-cookies-box")
    if (cookiesLink !== null) {
      cookiesLink.onclick = function() { tarteaucitron.userInterface.openPanel();return false };
    }
  });
  // focus sur le lien Cookie quand on ferme la modale TAC
  window.addEventListener('tac.close_panel', function() {
    const cookiesLink = document.getElementById("open-cookies-box")
    cookiesLink.focus();
  })
<% end -%>
