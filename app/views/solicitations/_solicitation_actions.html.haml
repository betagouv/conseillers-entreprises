.ui.compact.inverted.green.menu
  - if solicitation.diagnosis.nil?
    - if solicitation.may_prepare_diagnosis?
      - if solicitation.prepare_diagnosis_errors.present?
        .ui.item
          - error_text = solicitation.prepare_diagnosis_errors.full_messages.to_sentence
          .ui.icon{ data: { tooltip: error_text, variation: 'fixed' } }
            %i.warning.sign.icon
            = t('.prepare_diagnosis_errors', count: solicitation.prepare_diagnosis_errors.count)
        .ui.item.dropdown
          = t('.prepare_diagnosis_retry')
          %i.dropdown.icon
          .ui.menu
            = link_to prepare_diagnosis_solicitation_path(solicitation), class: 'item', method: :post do
              = t('.start_auto_diagnosis')
              %i.right.chevron.icon
            = link_to new_diagnosis_path(solicitation: solicitation.id), class: 'item' do
              = t('.start_manual_diagnosis')
              %i.right.chevron.icon
      - else
        = link_to prepare_diagnosis_solicitation_path(solicitation), class: 'ui item', method: :post do
          %i.rocket.icon
          = t('.start_auto_diagnosis')
          %i.right.chevron.icon
    - else
      = link_to new_diagnosis_path(solicitation: solicitation.id), class: 'ui item' do
        = t('.start_diagnosis')
        %i.right.chevron.icon
  - else
    = link_to_diagnosis(solicitation.diagnosis)

  .ui.item.dropdown
    %i.settings.icon
    .ui.menu
      - solicitation.allowed_new_statuses.each do |status|
        = status_action_link(solicitation, status, %w[item])
      .item.show-feedbacks-form{ 'data-feedbackable': "#{solicitation.id}" }= t('feedbacks.add')
