- cache [need, action] do
  .card-reminders-need.fr-my-4w.card
    .card__header.fr-enlarge-link
      .card__title
        %h2= link_to need.company.name, need_path(need, origin: 'reminders')
        %span.subtitle= I18n.l(need.display_date, format: :long)
      = status_label(need)
    .fr-card__body
      .card__need.fr-mb-2w
        .card__need-title
          %h3.fr-h6
            = need.subject
          .subtitle
            = need.matches.human_count
            - if need.abandoned?
              .label.label--sm.orange= t('diagnoses.diagnosis.last_activity_date', l: l(need.updated_at.to_date, format: :long))

      .card__match-list.fr-mb-2w
        - need.matches.preload(expert: :antenne).each do |match|
          - expert = match.expert
          .item
            ‚ÅÉ #{expert.antenne.to_s}
            - if PositionningRate::Member.new(expert).critical_rate?
              = link_to reminders_expert_path(expert), class: 'picto', data: { turbolinks: false } do
                %span.ri-vip-crown-2-fill{ title: t('.critical_rate_expert') }
      .card__feedbacks
        %div{ id: "display-feedbacks-#{need.id}" }
          = render partial: 'feedbacks/feedback', collection: need.reminder_feedbacks
        = render 'feedbacks/form', feedback: need.reminder_feedbacks.new
    .card__footer
      - if action.present?
        .abandoned-email{ id: "abandoned-email-#{need.id}" }
          - if !need.abandoned_email_sent
            = form_with model: need, url: send_abandoned_email_reminders_need_path(need), method: :post do |f|
              = f.submit t('.send_abandoned_need_email'), class: 'fr-btn fr-btn--secondary fr-mr-2v'
          - elsif need.abandoned_email_sent
            %p.fr-btn.fr-btn--secondary.fr-fi-checkbox-circle-line.fr-btn--icon-left.fr-btn-green.fr-mr-2v
              = t('.abandoned_need_email_sent')
        = link_to t(action, scope: 'reminders.needs.scopes.mark_done'), polymorphic_path([action, :reminders_action], { id: need.id }),
                method: :post, class: "fr-btn #{action == :archive ? 'btn-red' : 'btn-green'}"
